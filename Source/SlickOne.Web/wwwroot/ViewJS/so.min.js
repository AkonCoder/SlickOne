var filelist=function(){function e(){}return e.initXmlImport=function(){new qq.FineUploader({element:document.getElementById("fine-uploader-validation"),template:"qq-template-validation",request:{endpoint:"api/FineUpload/import",params:{extraParam1:"1",extraParam2:"2"}},thumbnails:{placeholders:{waitingPath:"Content/fineuploader/waiting-generic.png",notAvailablePath:"Content/fineuploader/not_available-generic.png"}},validation:{allowedExtensions:["xml","txt"],itemLimit:1,sizeLimit:51200},callbacks:{onComplete:function(e,t,o){1==o.success?$.msgBox({title:"Designer / Process",content:o.Message,type:"info",buttons:[{value:"Ok"}]}):$.msgBox({title:"Designer / Process",content:o.ExceptionMessage,type:"error",buttons:[{value:"Ok"}]})}}})},e}(),loglist=function(){function e(){}return e.getLogList=function(){jshelper.ajaxGet("api/WfData/GetLogList",null,function(e){function t(){i.api.getSelectedRows().forEach(function(e,t){processlist.pselectedLogID=e.ID,processlist.pselecteLogDataRow=e})}if(1===e.Status){var o=document.querySelector("#myloggrid");$(o).empty();var i={columnDefs:[{headerName:"ID",field:"ID",width:50},{headerName:"类型",field:"EventTypeID",width:60},{headerName:"优先级",field:"Priority",width:60},{headerName:"紧急",field:"Severity",width:60},{headerName:"标题",field:"Title",width:160},{headerName:"信息",field:"Message",width:160},{headerName:"创建日期",field:"Timestamp",width:120}],rowSelection:"single",onSelectionChanged:t};new agGrid.Grid(o,i),i.api.setRowData(e.Entity)}else $.msgBox({title:"Form / List",content:"读取日志记录失败！错误信息："+e.Message,type:"error"})})},e}(),processlist=function(){function e(){}return e.getProcessList=function(){jshelper.ajaxGet("api/WfData/GetProcessListSimple",null,function(t){function o(){a.api.getSelectedRows().forEach(function(t,o){e.pselectedProcessGUID=t.ProcessGUID,e.pselectedProcessDataRow=t})}if(1===t.Status){var i=document.querySelector("#myprocessgrid");$(i).empty();var a={columnDefs:[{headerName:"ID",field:"ID",width:50},{headerName:"流程GUID",field:"ProcessGUID",width:120},{headerName:"流程名称",field:"ProcessName",width:160},{headerName:"版本",field:"Version",width:40},{headerName:"状态",field:"IsUsing",width:60},{headerName:"创建日期",field:"CreatedDateTime",width:120}],rowSelection:"single",onSelectionChanged:o};new agGrid.Grid(i,a),a.api.setRowData(t.Entity)}else $.msgBox({title:"Process / List",content:"读取流程定义记录失败！错误信息："+t.Message,type:"error"})})},e.getProcessInstanceList=function(){jshelper.ajaxGet("api/WfData/GetProcessInstanceList",null,function(e){function t(){i.api.getSelectedRows().forEach(function(e,t){processinstancelist.pselectedProcessInstanceID=e.ID,processinstancelist.pselectedProcessInstanceDataRow=e})}if(1===e.Status){var o=document.querySelector("#myprocessinstancegrid");$(o).empty();var i={columnDefs:[{headerName:"ID",field:"ID",width:50},{headerName:"流程名称",field:"ProcessName",width:160},{headerName:"应用名称",field:"AppName",width:120},{headerName:"状态",field:"ProcessState",width:40},{headerName:"创建日期",field:"CreatedDateTime",width:120},{headerName:"创建用户",field:"CreatedByUserName",width:60},{headerName:"完成日期",field:"EndedDateTime",width:120},{headerName:"完成用户",field:"EndedByUserName",width:60}],rowSelection:"single",onSelectionChanged:t};new agGrid.Grid(o,i),i.api.setRowData(e.Entity)}else $.msgBox({title:"ProcessInstance / List",content:"读取流程实例记录失败！错误信息："+e.Message,type:"error"})})},e.getActivityInstanceList=function(){jshelper.ajaxGet("api/WfData/GetActivityInstanceList",null,function(e){function t(){i.api.getSelectedRows().forEach(function(e,t){activityinstancelist.pselectedActivityInstanceID=e.ID,activityinstancelist.pselectedActivityInstanceDataRow=e})}if(1===e.Status){var o=document.querySelector("#myactivityinstancegrid");$(o).empty();var i={columnDefs:[{headerName:"ID",field:"ID",width:50},{headerName:"应用名称",field:"AppName",width:120},{headerName:"活动名称",field:"ActivityName",width:60},{headerName:"状态",field:"ActivityState",width:40},{headerName:"类型",field:"ActivityType",width:40},{headerName:"分配用户",field:"AssignedToUserNames",width:160},{headerName:"创建日期",field:"CreatedDateTime",width:120},{headerName:"创建用户",field:"CreatedByUserName",width:60},{headerName:"完成日期",field:"EndedDateTime",width:120},{headerName:"完成用户",field:"EndedByUserName",width:60}],rowSelection:"single",onSelectionChanged:t};new agGrid.Grid(o,i),i.api.setRowData(e.Entity)}else $.msgBox({title:"ActivityInstance / List",content:"读取活动实例记录失败！错误信息："+e.Message,type:"error"})})},e.getEntityDefList=function(){jshelper.ajaxGet("api/WfData/GetEntityDefListSimple",null,function(t){function o(){a.api.getSelectedRows().forEach(function(t,o){e.pselectedFormID=t.ID,e.pselecteFormDataRow=t})}if(1===t.Status){var i=document.querySelector("#myentitydefgrid");$(i).empty();var a={columnDefs:[{headerName:"ID",field:"ID",width:50},{headerName:"表单名称",field:"EntityName",width:120},{headerName:"表单标题",field:"EntityTitle",width:160},{headerName:"表单编码",field:"EntityCode",width:80},{headerName:"描述",field:"Description",width:160},{headerName:"创建日期",field:"CreatedDate",width:120}],rowSelection:"single",onSelectionChanged:o};new agGrid.Grid(i,a),a.api.setRowData(t.Entity)}else $.msgBox({title:"EntityDef / List",content:"读取表单定义记录失败！错误信息："+t.Message,type:"error"})})},e}(),productlist=function(){function e(){}function t(e){function t(){i.api.getSelectedRows().forEach(function(e,t){rolelist.pselectedProductID=e.ID,rolelist.pselectedProductDataRow=e})}$("#loading-indicator").show();var o=document.querySelector("#myProductGrid");$(o).empty();var i={columnDefs:[{headerName:"ID",field:"ID",width:40,cssClass:"bg-gray"},{headerName:"名称",field:"ProductName",width:120,cssClass:"bg-gray"},{headerName:"编码",field:"ProductCode",width:120,cssClass:"bg-gray"},{headerName:"类型",field:"ProductType",width:160,cssClass:"bg-gray"},{headerName:"单价",field:"UnitPrice",width:160,cssClass:"bg-gray"},{headerName:"创建时间",field:"CreatedDate",width:200,cssClass:"bg-gray",formatter:datetimeFormatter}],rowSelection:"single",onSelectionChanged:t};new agGrid.Grid(o,i),i.api.setRowData(e),$("#loading-indicator").hide()}return e.mselectedProductID=0,e.mselectedProductRow=null,e.load=function(){jshelper.ajaxGet("/api/product/GetProductList",null,function(e){1==e.Status?t(e.Entity):$.msgBox({title:"Product / List",content:e.Message,type:"error",buttons:[{value:"Ok"}]})})},e.query=function(){var e={};e.ProductType=$("#ddlProductTypeQuery").val(),null!=e.ProductType&&"default"!=e.ProductType&&jshelper.ajaxPost("/soneweb/api/product/query",JSON.stringify(e),function(e){1==e.Status?(t(e.Entity),$("#modelProductQueryForm").modal("hide")):$.msgBox({title:"Product / Query",content:e.Message,type:"error",buttons:[{value:"Ok"}]})})},e.getProductByID=function(){e.mselectedProductID>0&&jshelper.ajaxGet("/soneweb/api/product/Get/"+e.mselectedProductID,null,function(e){if(1==e.Status){var t=e.Entity;$("#txtProductName").val(t.ProductName),$("#ddlProductType").val(t.ProductType),$("#txtProductCode").val(t.ProductCode),$("#txtUnitPrice").val(t.UnitPrice),$("#txtNotes").val(t.Notes)}else $.msgBox({title:"Product / Edit",content:e.Message,type:"error",buttons:[{value:"Ok"}]})})},e.sure=function(){var t={};t.ID=e.mselectedProductID,t.ProductName=$("#txtProductName").val(),t.ProductType=$("#ddlProductType").val(),t.ProductCode=$("#txtProductCode").val(),t.UnitPrice=$("#txtUnitPrice").val(),t.Notes=$("#txtNotes").val(),jshelper.ajaxPost("/soneweb/api/product/save",JSON.stringify(t),function(t){1==t.Status?($.msgBox({title:"Product / Edit",content:"产品记录保存成功！",type:"info"}),e.load()):$.msgBox({title:"Product / Save",content:t.Message,type:"error",buttons:[{value:"Ok"}]})}),$("#modelProductEditForm").modal("hide")},e.delete=function(){0!=e.mselectedProductID&&$.msgBox({title:"Are You Sure",content:"确定要删除产品数据记录吗? ",type:"confirm",buttons:[{value:"Yes"},{value:"Cancel"}],success:function(t){"Yes"==t&&jshelper.ajaxGet("/soneweb/api/product/Delete/"+e.mselectedProductID,null,function(t){1==t.Status?($.msgBox({title:"Biz / Product",content:"产品记录已经删除！",type:"info"}),e.load()):$.msgBox({title:"Product / Delete",content:t.Message,type:"error",buttons:[{value:"Ok"}]})})}})},e}(),resourcelist=function(){function e(){}return e.getResourceList=function(){jshelper.ajaxGet("api/ResourceData/GetResourceNodeAll",null,function(t){function o(e){return e.node.data.ResourceName}function i(t){var o=t.node;e.pselectedResourceID=o.data.ID,e.pselectedResourceDataRow=o.data}if(1===t.Status){var a={columnDefs:[{headerName:"ID",field:"ID",width:40,cssClass:"bg-gray"},{headerName:"资源名称",field:"ResourceName",width:160,cssClass:"bg-gray",cellRenderer:"group",cellRendererParams:{innerRenderer:o}},{headerName:"资源代码",field:"ResourceCode",width:200,cssClass:"bg-gray"},{headerName:"页面URL",field:"PageUrl",width:120,cssClass:"bg-gray"},{headerName:"标签ID",field:"TagID",width:120,cssClass:"bg-gray"},{headerName:"样式",field:"StyleClass",width:200,cssClass:"bg-gray"},{headerName:"排序",field:"OrderNum",width:60,cssClass:"bg-gray"}],rowSelection:"single",enableColResize:!0,enableSorting:!0,animateRows:!0,rowHeight:30,getNodeChildDetails:function(e){return e.group?{group:!0,name:e.ResourceName,children:e.children,expanded:e.ResourceTypeID<3?"true":"false"}:null},onRowClicked:i},r=document.querySelector("#myresourcegrid");$(r).empty();var n=[];n.push(t.Entity),new agGrid.Grid(r,a),a.api.setRowData(n)}else $.msgBox({title:"Role / List",content:"读取资源记录失败！错误信息："+t.Message,type:"error"})})},e}(),resourcetree=function(){function e(){}function t(e,t){if("root"!==t.type){var o=$("#"+t.tId+"_span"),i="",n=null,s=null;if("resource"===t.type){if(t.editNameFlag||$("#addBtn_"+t.tId).length>0)return;if(i+="<span class='button add' id='addBtn_"+t.tId+"' title='添加资源' ></span>",o.after(i),(n=$("#addBtn_"+t.tId))&&n.bind("click",function(){a(t.roleId)}),t.editNameFlag||$("#rmvBtn_"+t.tId).length>0)return;i="<span class='button remove' id='rmvBtn_"+t.tId+"' title='删除资源' onfocus='this.blur();'></span>",o.after(i),(s=$("#rmvBtn_"+t.tId))&&s.bind("click",function(){r(t.roleId)})}}}function o(e,t){$("#addBtn_"+t.tId).unbind().remove(),$("#rmvBtn_"+t.tId).unbind().remove()}function i(){return{check:{enable:!0},view:{addHoverDom:t,removeHoverDom:o,dblClickExpand:!1,showLine:!0,selectedMulti:!1},data:{simpleData:{enable:!0,idKey:"id",pIdKey:"pId",rootPId:""}},callback:{beforeClick:function(e,t){var o=$.fn.zTree.getZTreeObj("myresourcetree");return!t.isParent||(o.expandNode(t),!1)},onClick:function(e,t,o){}}}}function a(e){userlistdialog.pselectedRoleID=e,BootstrapDialog.show({title:"Resource",message:$("<div></div>").load("Resource/Edit")})}function r(e){$.msgBox({title:"Are You Sure",content:"确实要删除资源记录吗? 请您慎重操作!!!",type:"confirm",buttons:[{value:"Yes"},{value:"Cancel"}],success:function(t){if("Yes"==t){var o={ResourceID:e};return void resourceapi.delete(o)}}})}return e.pmztree=null,e.getResourceTree=function(){var t=[{id:0,pId:-1,name:"资源列表",type:"root",open:!0}];jshelper.ajaxGet("api/ResourceData/GetResourceAll",null,function(o){if(1==o.Status){var a=null,r=0,n=o.Entity;$.each(n,function(e,o){var i="r"+o.ID;r!==i&&(a={id:i,pId:0,resourceId:o.ID,name:o.ResourceName,type:"resource",open:!1},t.push(a),r=i)});var s=$("#myresourcetree");e.pmztree=$.fn.zTree.init(s,i(),t)}})},e}(),resourceapi=function(){function e(){}return e.addResource=function(e){jshelper.ajaxPost("api/ResourceData/SaveResource",JSON.stringify(e),function(e){1==e.Status?($.msgBox({title:"SlickOne / Resource",content:"已经成功保存资源数据！",type:"info"}),resourcetree.getResourceTree()):$.msgBox({title:"SlickOne / Resource",content:e.Message,type:"error",buttons:[{value:"Ok"}]})})},e.delete=function(e){jshelper.ajaxPost("api/ResourceData/DeleteResource",JSON.stringify(e),function(e){1==e.Status?($.msgBox({title:"SlickOne / Resource",content:"资源记录已经删除！",type:"info"}),resourcetree.getResourceTree()):$.msgBox({title:"Ooops",content:e.Message,type:"error",buttons:[{value:"Ok"}]})})},e}(),tasklist=function(){function e(){}return e}(),userlist=function(){function e(){}return e.pselectedUserID="",e.pselectedUserDataRow=null,e.getUserList=function(){jshelper.ajaxGet("api/RoleData/GetUserAll",null,function(t){function o(){a.api.getSelectedRows().forEach(function(t,o){e.pselectedUserID=t.ID,e.pselectedUserDataRow=t})}if(1===t.Status){var i=document.querySelector("#myusergrid");$(i).empty();var a={columnDefs:[{headerName:"ID",field:"ID",width:40,cssClass:"bg-gray"},{headerName:"用户名称",field:"UserName",width:120,cssClass:"bg-gray"}],rowSelection:"single",onSelectionChanged:o};new agGrid.Grid(i,a),a.api.setRowData(t.Entity)}else $.msgBox({title:"User / List",content:"读取用户记录失败！错误信息："+t.Message,type:"error"})})},e.loadUser=function(){if("edit"===somain.activeToolButtonType&&""!=e.pselectedUserID){var t=e.pselectedUserDataRow;$("#txtUserName").val(t.UserName)}else $("#txtUserName").val("")},e.editUser=function(){if(null==e.pselectedUserDataRow)return $.msgBox({title:"SlickOne / User",content:"请先选择用户记录！",type:"alert"}),!1;BootstrapDialog.show({title:"user",message:$("<div></div>").load("user/edit")})},e.saveUser=function(){if(""==$("#txtUserName").val()||""==$("#txtUserCode").val())return $.msgBox({title:"SlickOne / User",content:"请输入角色基本信息！",type:"alert"}),!1;var t={ID:"0",UserName:$("#txtUserName").val(),UserCode:$("#txtUserCode").val()};"edit"===somain.activeToolButtonType&&(t.ID=e.pselectedUserID),userapi.save(t)},e.delete=function(){$.msgBox({title:"Are You Sure",content:"确实要删除用户记录吗? ",type:"confirm",buttons:[{value:"Yes"},{value:"Cancel"}],success:function(t){if("Yes"==t){var o={ID:e.pselectedUserID};return void userapi.delete(o)}}})},e.sure=function(){$("#modelRoleListForm").modal("hide"),e.pselecteUserID},e}(),userapi=function(){function e(){}return e.save=function(e){jshelper.ajaxPost("api/RoleData/SaveUser",JSON.stringify(e),function(e){1==e.Status?$.msgBox({title:"SlickOne / User",content:"用户记录成功保存！",type:"info"}):$.msgBox({title:"Ooops",content:e.Message,type:"error",buttons:[{value:"Ok"}]})})},e.delete=function(e){jshelper.ajaxPost("api/RoleData/DeleteUser",JSON.stringify(e),function(e){1==e.Status?($.msgBox({title:"SlickOne / User",content:"用户记录已经删除！",type:"info"}),userlist.getUserList()):$.msgBox({title:"Ooops",content:e.Message,type:"error",buttons:[{value:"Ok"}]})})},e}(),userlistdialog=function(){function e(){}return e.pselectedRoleID="",e.pselectedUserID="",e.pselectedUserDataRow=null,e.onUserSelected4Adding=new slick.Event,e.getUserList=function(){jshelper.ajaxGet("api/RoleData/GetUserAll",null,function(t){function o(){a.api.getSelectedRows().forEach(function(t,o){e.pselectedUserID=t.ID,e.pselectedUserDataRow=t})}if(1===t.Status){var i=document.querySelector("#myuserlistdialoggrid");$(i).empty();var a={columnDefs:[{headerName:"ID",field:"ID",width:40,cssClass:"bg-gray"},{headerName:"用户名称",field:"UserName",width:120,cssClass:"bg-gray"}],rowSelection:"single",onSelectionChanged:o};new agGrid.Grid(i,a),a.api.setRowData(t.Entity)}})},e.sure=function(){slick.trigger(e.onUserSelected4Adding,{UserID:e.pselectedUserID,RoleID:e.pselectedRoleID})},e.cancel=function(){e.pselectedUserID="",e.pselectedUserDataRow=null},e}(),soconfig=function(){function e(){}return e.sideBar={},e.sideBar.myrolegrid={},e.sideBar.myrolegrid.tabName="角色记录",e.sideBar.myrolegrid.pageUrl="role/list",e.sideBar.myusergrid={},e.sideBar.myusergrid.tabName="用户记录",e.sideBar.myusergrid.pageUrl="user/list",e.sideBar.myroleusertree={},e.sideBar.myroleusertree.tabName="角色用户维护",e.sideBar.myroleusertree.pageUrl="roleuser/list",e.sideBar.myrolepermissiongrid={},e.sideBar.myrolepermissiongrid.tabName="角色授权",e.sideBar.myrolepermissiongrid.pageUrl="permission/list",e.sideBar.myresourcegrid={},e.sideBar.myresourcegrid.tabName="资源数据",e.sideBar.myresourcegrid.pageUrl="resource/list",e.sideBar.myprocessgrid={},e.sideBar.myprocessgrid.tabName="流程记录",e.sideBar.myprocessgrid.pageUrl="workflow/process",e.sideBar.myentitydefgrid={},e.sideBar.myentitydefgrid.tabName="表单记录",e.sideBar.myentitydefgrid.pageUrl="workflow/entitydef",e.sideBar.myprocessinstancegrid={},e.sideBar.myprocessinstancegrid.tabName="流程实例",e.sideBar.myprocessinstancegrid.pageUrl="workflow/processinstance",e.sideBar.myactivityinstancegrid={},e.sideBar.myactivityinstancegrid.tabName="活动实例",e.sideBar.myactivityinstancegrid.pageUrl="workflow/activityinstance",e.sideBar.mymessagebox={},e.sideBar.mymessagebox.tabName="消息弹框",e.sideBar.mymessagebox.pageUrl="message/popup",e.sideBar.mymodaldialog={},e.sideBar.mymodaldialog.tabName="模式窗口",e.sideBar.mymodaldialog.pageUrl="message/dialog",e.sideBar.myfileupload={},e.sideBar.myfileupload.tabName="文件上传",e.sideBar.myfileupload.pageUrl="file/upload",e.sideBar.mycloudupload={},e.sideBar.mycloudupload.tabName="云端上传",e.sideBar.mycloudupload.pageUrl="cloud/upload",e.sideBar.mynotifybox={},e.sideBar.mynotifybox.tabName="通知消息",e.sideBar.mynotifybox.pageUrl="im/notification",e.toolbutton=[],e.toolbutton.add=[],e.toolbutton.edit=[],e.toolbutton.delete=[],e.toolbutton.query=[],e.toolbutton.add.myrolegrid="role/edit",e.toolbutton.add.myusergrid="user/edit",e.toolbutton.add.myresourcegrid="resource/edit",e.toolbutton.edit.myrolegrid="role/edit",e.toolbutton.edit.myusergrid="user/edit",e.toolbutton.delete.myrolegrid=rolelist.delete,e.toolbutton.delete.myusergrid=userlist.delete,e}(),rolelist=function(){function e(){}return e.pselectedRoleID="",e.pselectedRoleDataRow=null,e.getRoleList=function(){jshelper.ajaxGet("api/RoleData/GetRoleAll",null,function(t){function o(){a.api.getSelectedRows().forEach(function(t,o){e.pselectedRoleID=t.ID,e.pselectedRoleDataRow=t})}if(1===t.Status){var i=document.querySelector("#myrolegrid");$(i).empty();var a={columnDefs:[{headerName:"ID",field:"ID",width:40,cssClass:"bg-gray"},{headerName:"角色名称",field:"RoleName",width:120,cssClass:"bg-gray"},{headerName:"角色代码",field:"RoleCode",width:160,cssClass:"bg-gray"}],rowSelection:"single",onSelectionChanged:o};new agGrid.Grid(i,a),a.api.setRowData(t.Entity)}else $.msgBox({title:"Role / List",content:"读取角色记录失败！错误信息："+t.Message,type:"error"})})},e.loadRole=function(){if("edit"===somain.activeToolButtonType&&""!=e.pselectedRoleID){var t=e.pselectedRoleDataRow;$("#txtRoleName").val(t.RoleName),$("#txtRoleCode").val(t.RoleCode)}else $("#txtRoleName").val(""),$("#txtRoleCode").val("")},e.editRole=function(){if(null==e.pselectedRoleDataRow)return $.msgBox({title:"SlickOne / Role",content:"请先选择角色记录！",type:"alert"}),!1},e.saveRole=function(){if(""==$("#txtRoleName").val()||""==$("#txtRoleCode").val())return $.msgBox({title:"SlickOne / Role",content:"请输入角色基本信息！",type:"alert"}),!1;var t={ID:"0",RoleName:$("#txtRoleName").val(),RoleCode:$("#txtRoleCode").val()};"edit"===somain.activeToolButtonType&&(t.ID=e.pselectedRoleID),roleapi.save(t)},e.delete=function(){$.msgBox({title:"Are You Sure",content:"确实要删除角色记录吗? ",type:"confirm",buttons:[{value:"Yes"},{value:"Cancel"}],success:function(t){if("Yes"==t){var o={ID:e.pselectedRoleID};return void roleapi.delete(o)}}})},e.sure=function(){e.pselecteRoleID},e}(),roleapi=function(){function e(){}return e.save=function(e){jshelper.ajaxPost("api/RoleData/SaveRole",JSON.stringify(e),function(e){1==e.Status?$.msgBox({title:"SlickOne / Role",content:"角色记录已经成功保存！",type:"info"}):$.msgBox({title:"SlickOne / Role",content:e.Message,type:"error",buttons:[{value:"Ok"}]})})},e.delete=function(e){jshelper.ajaxPost("api/RoleData/DeleteRole",JSON.stringify(e),function(e){1==e.Status?($.msgBox({title:"SlickOne / Role",content:"角色记录已经删除！",type:"info"}),rolelist.getRoleList()):$.msgBox({title:"Ooops",content:e.Message,type:"error",buttons:[{value:"Ok"}]})})},e}(),roleusertree=function(){function e(){}function t(e,t){if("root"!==t.type){var o=$("#"+t.tId+"_span"),i="",a=null,l=null;if("role"===t.type){if(t.editNameFlag||$("#addBtn_"+t.tId).length>0)return;if(i+="<span class='button add' id='addBtn_"+t.tId+"' title='添加用户' ></span>",o.after(i),(a=$("#addBtn_"+t.tId))&&a.bind("click",function(){r(t.roleId)}),t.editNameFlag||$("#rmvBtn_"+t.tId).length>0)return;i="<span class='button remove' id='rmvBtn_"+t.tId+"' title='全部删除用户' onfocus='this.blur();'></span>",o.after(i),(l=$("#rmvBtn_"+t.tId))&&l.bind("click",function(){n(t.roleId)})}else if("user"===t.type){if(t.editNameFlag||$("#rmvBtn_"+t.tId).length>0)return;i="<span class='button remove' id='rmvBtn_"+t.tId+"' title='删除用户' onfocus='this.blur();'></span>",o.after(i),(l=$("#rmvBtn_"+t.tId))&&l.bind("click",function(){s(t.userId,t.roleId)})}}}function o(e,t){$("#addBtn_"+t.tId).unbind().remove(),$("#rmvBtn_"+t.tId).unbind().remove()}function i(){return{check:{enable:!0},view:{addHoverDom:t,removeHoverDom:o,dblClickExpand:!1,showLine:!0,selectedMulti:!1},data:{simpleData:{enable:!0,idKey:"id",pIdKey:"pId",rootPId:""}},callback:{beforeClick:function(e,t){var o=$.fn.zTree.getZTreeObj("myroleusertree");return!t.isParent||(o.expandNode(t),!1)},onClick:function(e,t,o){}}}}function a(e,t){t.RoleID>0&&t.UserID>0&&roleuserapi.addRoleUser(t)}function r(e){userlistdialog.pselectedRoleID=e,BootstrapDialog.show({title:"User",message:$("<div></div>").load("User/Dialog")})}function n(e){$.msgBox({title:"Are You Sure",content:"确实要删除角色下的全部用户记录吗? 请您慎重操作!!!",type:"confirm",buttons:[{value:"Yes"},{value:"Cancel"}],success:function(t){if("Yes"==t){var o={UserID:-1,RoleID:e};return void roleuserapi.delete(o)}}})}function s(e,t){$.msgBox({title:"Are You Sure",content:"确实要删除角色下的用户记录吗? ",type:"confirm",buttons:[{value:"Yes"},{value:"Cancel"}],success:function(o){if("Yes"==o){var i={UserID:e,RoleID:t};return void roleuserapi.delete(i)}}})}return e.pmztree=null,e.getRoleUserTree=function(){var t=[{id:0,pId:-1,name:"角色列表",type:"root",open:!0}];jshelper.ajaxGet("api/RoleData/GetRoleUserAll",null,function(o){if(1==o.Status){var r=null,n=null,s=0,l=o.Entity;$.each(l,function(e,o){var i="r"+o.RoleID;s!==i&&(r={id:i,pId:0,roleId:o.RoleID,name:o.RoleName,type:"role",open:!1},t.push(r),s=i),0!==o.ID&&(n={id:"ru"+o.ID,pId:s,userId:o.UserID,name:o.UserName,roleId:o.RoleID,type:"user",open:!1},t.push(n))});var d=$("#myroleusertree");e.pmztree=$.fn.zTree.init(d,i(),t),userlistdialog.onUserSelected4Adding.subscribe(a)}})},e}(),roleuserapi=function(){function e(){}return e.addRoleUser=function(e){jshelper.ajaxPost("api/RoleData/AddRoleUser",JSON.stringify(e),function(e){1==e.Status?($.msgBox({title:"SlickOne / Role",content:"已经成功添加用户到该角色！",type:"info"}),roleusertree.getRoleUserTree()):$.msgBox({title:"SlickOne / Role",content:e.Message,type:"error",buttons:[{value:"Ok"}]})})},e.delete=function(e){jshelper.ajaxPost("api/RoleData/DeleteRoleUser",JSON.stringify(e),function(e){1==e.Status?($.msgBox({title:"SlickOne / Role",content:"角色下的用户记录已经删除！",type:"info"}),roleusertree.getRoleUserTree()):$.msgBox({title:"Ooops",content:e.Message,type:"error",buttons:[{value:"Ok"}]})})},e}(),permissionlist=function(){function e(){}function t(t){$("#treeContainer").show();var i={RoleID:t};jshelper.ajaxPost("api/ResourceData/GetRoleResourceList",JSON.stringify(i),function(t){if(1===t.Status){var i=[{id:0,pId:-1,name:"权限列表",type:"root",open:!0}],a=null,r=t.Entity;$.each(r,function(e,t){a={id:t.ID,pId:t.ParentID,name:t.ResourceName,open:!0},i.push(a)});var n=$("#myroleresourcetree");e.pmztree=$.fn.zTree.init(n,o(),i)}else $.msgBox({title:"Permission / List",content:"读取资源权限数据失败！错误信息："+t.Message,type:"error"})})}function o(){return{check:{enable:!0},view:{dblClickExpand:!1,showLine:!0,selectedMulti:!1},data:{simpleData:{enable:!0,idKey:"id",pIdKey:"pId",rootPId:""}},callback:{beforeClick:function(e,t){var o=$.fn.zTree.getZTreeObj("myroleresourcetree");return!t.isParent||(o.expandNode(t),!1)},onClick:function(e,t,o){}}}}return e.getRoleList=function(){jshelper.ajaxGet("api/RoleData/GetRoleAll",null,function(o){function i(o){var i=o.node;e.pselectedRoleID=i.data.ID,e.pselectedResourceDataRow=i.data,t(e.pselectedRoleID)}if(1===o.Status){var a=document.querySelector("#myrolepermissiongrid");$(a).empty();var r={columnDefs:[{headerName:"ID",field:"ID",width:40,cssClass:"bg-gray"},{headerName:"角色名称",field:"RoleName",width:140,cssClass:"bg-gray"},{headerName:"角色代码",field:"RoleCode",width:140,cssClass:"bg-gray"}],rowSelection:"single",onRowClicked:i};new agGrid.Grid(a,r),r.api.setRowData(o.Entity)}else $.msgBox({title:"Permission / List",content:"读取角色记录失败！错误信息："+o.Message,type:"error"})})},e.savePermission=function(){var t={RoleID:e.pselectedRoleID};jshelper.ajaxPost("api/ResourceData/SaveRoleResource",JSON.stringify(t),function(e){1===e.Status?$.msgBox({title:"Permission / List",content:"保存角色资源权限数据成功(DEMO)!",type:"info"}):$.msgBox({title:"Permission / List",content:"保存角色资源权限数据失败！错误信息："+e.Message,type:"error"})})},e.cancel=function(){$("#treeContainer").hide()},e}(),somain=function(){function e(){}function t(){jshelper.ajaxGet("api/ResourceData/GetResourceNodeAll",null,function(e){if(1===e.Status)e.Entity;else $.msgBox({title:"Menu / List",content:"读取菜单记录失败！错误信息："+e.Message,type:"error"})})}function o(e,t){$(e).empty(),soconfig.sideBar[t]&&""!==soconfig.sideBar[t].pageUrl?(a(),$(e).load(soconfig.sideBar[t].pageUrl)):window.console.log("未定义页面URL，名称信息："+t)}function i(t){var o=soconfig.toolbutton[t][e.activeTabName];void 0!==o&&($("#loading-indicator").show(),BootstrapDialog.show({title:soconfig.sideBar[e.activeTabName].tabName,message:$("<div></div>").load(o)}),$("#loading-indicator").hide())}function a(){$(".progress .progress-bar").progressbar({transition_delay:200});var e=$(".js-loading-bar");e.find(".bar");e.modal("show"),setTimeout(function(){e.modal("hide")},500)}return e.tablist=[],e.activeTabName="",e.activeToolButtonType="",e.init=function(){function e(){1==i?(o.removeClass("is-open"),o.addClass("is-closed"),i=!1):(o.removeClass("is-closed"),o.addClass("is-open"),i=!0)}var o=$(".hamburger"),i=!1;o.click(function(){e()}),$('[data-toggle="offcanvas"]').click(function(){$("#wrapper").toggleClass("toggled")}),t()},e.initPage=function(){$("#myTab").on("click","a",function(e){e.preventDefault(),$(this).tab("show")}),$("#myTab").on("click"," li a .close",function(){$(this).parents("li").children("a").attr("href");$(this).parents("li").remove("li"),$("#myTab a:first").tab("show")}),$("#myTab").tab()},e.showTab=function(t){if("mydashboard"!==t){var i=t+"Tab",a=$("a[href='#"+i+"_'");if(0===a.length){$("#myTab").append($('<li><a href="#'+i+'_">'+soconfig.sideBar[t].tabName+'<button class="close" type="button" title="Remove this page"> ×</button></a></li>'));var r=$('<div class="tab-pane" style="height:700px;width:100%;margin-top:10px;" id="'+i+'_"></div>').appendTo("#divTabContentContainer");e.activeTabControl=r,o(r,t),$("#myTab a:last").tab("show")}else a.tab("show");e.activeTabName=t}else $("#myTab a:first").tab("show")},e.addrecord=function(){e.activeToolButtonType="add",i(e.activeToolButtonType)},e.editrecord=function(){e.activeToolButtonType="edit",i(e.activeToolButtonType)},e.deleterecord=function(){e.activeToolButtonType="delete",window.console.log(e.activeTabName),soconfig.toolbutton[e.activeToolButtonType][e.activeTabName]&&soconfig.toolbutton[e.activeToolButtonType][e.activeTabName]()},e.refreshrecord=function(){e.activeToolButtonType="refresh",o(e.activeTabControl,e.activeTabName)},e}();